<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Small Joys</title>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8Q8NK30MG9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-8Q8NK30MG9');
    </script>

    <script>
        let isFetching = false;

        async function getNewJoy() {
            if (isFetching) return;

            // This now works because gtag was defined above!
            if (typeof gtag === 'function') {
                gtag('event', 'get_new_joy', { 'event_category': 'engagement' });
            }

            const textElement = document.getElementById('joy-text');
            const joyBtn = document.querySelector('.main-action');

            isFetching = true;
            if (joyBtn) {
                joyBtn.style.opacity = "0.5";
                joyBtn.style.cursor = "not-allowed";
            }
            textElement.innerText = "Searching for joy...";

            try {
                const response = await fetch('/api/joy');
                if (!response.ok) throw new Error();
                const data = await response.json();
                textElement.innerText = `"${data.content}"`;
            } catch (error) {
                textElement.innerText = "Couldn't fetch Joys! Try again later.";
            } finally {
                isFetching = false;
                if (joyBtn) {
                    joyBtn.style.opacity = "1";
                    joyBtn.style.cursor = "pointer";
                }
            }
        }

        window.onload = () => {
            getNewJoy();
        };
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <div class="container">
        <header>
            <h1>Small Joys ğŸ€</h1>
            <p>Share life's little wins. One joy at a time.</p>
        </header>

        <div id="joy-card" class="joy-card">
            <p id="joy-text">Click the button below to find a reason to smile...</p>
        </div>

        <div class="action-grid">
            <button onclick="getNewJoy()" class="btn btn-primary main-action">Click for Joy</button>

            <div class="nav-links">
                <a href="/submit.html" class="nav-item">âœï¸ Submit your own Joy</a>
                <a href="/moderate.html" class="nav-item">ğŸ›¡ï¸ Moderation Desk</a>
                <a href="/swagger-ui/index.html" class="nav-item">ğŸ› ï¸ API Documentation</a>
            </div>
        </div>
        <div class="footer">
            <p>Â© 2026 Small Joys Project â€¢ <a href="mailto:sankalph1234@gmail.com">Contact Us</a></p>
            <p style="font-size: 0.7rem; margin-top: 10px;">
                ğŸ’¡ Pro Tip: For now, You can use our <a href="/swagger-ui/index.html">Interactive API Docs</a>
                to submit or moderate joys!
            </p>
        </div>
    </div>
</body>

</html>